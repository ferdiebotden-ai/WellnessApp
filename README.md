# Wellness OS Infrastructure & Development

## Overview
Wellness OS V3.2 is a HIPAA-compliant health and wellness management platform. This repository contains the complete codebase including infrastructure provisioning, backend services, and frontend application.

## Repository Structure

```
frontend/          # Next.js 14 application (App Router)
functions/         # Google Cloud Functions (Node.js 20 + TypeScript)
tests/             # All test files (Jest for backend, Playwright for E2E)
infra/             # Terraform configuration for GCP + Firebase
supabase/          # Database migrations, RLS policies, and seeds
scripts/           # Automation scripts for developer tooling
.github/workflows/ # CI/CD automation (GitHub Actions)
```

---

## Development Workflow with OpenAI Codex

This project uses **OpenAI Codex** as an autonomous coding agent integrated with GitHub. Here's how the workflow operates:

### Phase 1: Codex Writes Code (Autonomous)
1. **Human** provides a mission prompt to Codex via ChatGPT web interface
2. **Codex** reads the repository structure and `AGENTS.md` configuration
3. **Codex** writes production code (GCFs, APIs, React components)
4. **Codex** writes test files (Jest `.test.ts` for backend, Playwright `.spec.ts` for frontend)
5. **Codex** commits changes to a feature branch (`feature/mission-XXX-description`)
6. **Codex** creates a pull request

**Important:** Codex does NOT run tests. It only writes the test files.

### Phase 2: GitHub Actions Runs Tests (Automatic)
1. Pull request creation triggers CI/CD pipeline
2. GitHub Actions installs dependencies (`npm ci`)
3. For frontend missions: Installs Playwright browsers (`npx playwright install`)
4. Runs appropriate test suite:
   - Backend: `npm run test:backend` (Jest)
   - Frontend: `npm run test:ci` (Playwright)
5. Reports test results on the PR

### Phase 3: Human Review & Merge
1. Developer reviews code changes and test results
2. If tests pass and code looks good → Merge PR
3. If tests fail → Request Codex to fix issues

---

## Running Tests Locally (For Humans)

### Backend Tests (Jest)
```bash
npm run test:backend
```

Runs unit and integration tests for Google Cloud Functions.

### Frontend E2E Tests (Playwright)
```bash
# Install browsers first (one-time setup)
npx playwright install --with-deps

# Run tests
npm run test:ci
```

Runs end-to-end tests for user workflows.

### All Tests
```bash
npm run test:backend && npm run test:ci
```

---

## Mission-Based Development

This project follows a mission-based development approach where each feature is defined as a MISSION_XXX in the Blueprint document:

- **MISSION_001-005:** Infrastructure provisioning (Terraform, Firebase, Supabase)
- **MISSION_006-010:** AI coaching engine and adaptive nudging
- **MISSION_011-020:** Feature modules (gamification, analytics, onboarding)
- **MISSION_021-025:** Business and monetization features
- **MISSION_026-030:** Launch, compliance, and advanced AI features

Each mission is assigned to Codex via a requirements-focused prompt generated by Gemini 2.5 Pro.

---

## Key Technologies

### Backend
- **Google Cloud Functions** (Node.js 20, TypeScript)
- **Supabase** (PostgreSQL with Row-Level Security)
- **Firebase Authentication** (Identity provider)
- **OpenAI API** (GPT-4, zero-retention mode for HIPAA compliance)
- **Pinecone** (Vector database for RAG)

### Frontend
- **Next.js 14** (App Router, React 18, TypeScript 5)
- **Tailwind CSS** (Styling)
- **React Native** (Mobile app - future)

### Infrastructure
- **Terraform** (Infrastructure as Code)
- **GitHub Actions** (CI/CD)
- **GCP** (Cloud platform)

---

## Configuration Files

### `AGENTS.md`
Instructs Codex on project conventions, coding standards, and testing strategy. **Critical:** This file tells Codex to write tests but NOT run them.

### `package.json`
- `test:ci` - Playwright tests (run by GitHub Actions)
- `test:backend` - Jest tests for backend
- No default `test` script to prevent Codex from auto-running tests

### `jest.config.js`
Configuration for backend unit testing with Jest.

### `playwright.config.ts`
Configuration for frontend E2E testing with Playwright.

---

## Contributing

### For AI Agents (Codex)
Read `AGENTS.md` for complete instructions. Your job is to:
1. Write clean, tested code
2. Create test files (don't run them)
3. Commit to a feature branch
4. Create a pull request

### For Human Developers
1. Review PRs created by Codex
2. Check that tests pass in GitHub Actions
3. Merge approved PRs
4. Provide feedback to Codex if changes are needed

---

## Security & Compliance

- **HIPAA Compliant:** All PHI/PII encrypted at rest and in transit
- **Zero-Retention:** OpenAI API configured with `zero_retention: true`
- **Firebase Auth:** JWT validation on all protected endpoints
- **Supabase RLS:** Row-Level Security enforced for all user data
- **Secrets Management:** All API keys in environment variables (never committed)

---

## Mission 001 Outcomes

This repository was initialized with MISSION_001, which established:
- Terraform templates to provision GCP project, Firebase services, and IAM roles
- Firebase Authentication as system IdP with tenant configuration
- Supabase schema + RLS policies wired to Firebase JWT claims
- Reference Google Cloud Function verifying Firebase JWTs and querying Supabase

Follow the documentation inside each directory to deploy infrastructure in your target environment.

---

## Support

For questions about the Codex workflow or mission specifications, refer to:
- `AGENTS.md` - Codex configuration and conventions
- `WellnessOS-Codex-Prompting-and-Agent-Config-Merged.md` - Detailed prompt guide
- `Master-Blueprint-Wellness-OS-V3.2-Gemini-Synthesis.md` - Complete mission specifications
